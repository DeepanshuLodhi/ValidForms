<div class="form-container">
  <h2 class="form-title">{{ formConfig?.name }}</h2>
  
  <div *ngIf="formConfig">
    <!-- Fallback manual form implementation -->
    <div class="space-y-6">
      <!-- Personal Information -->
      <div class="bg-white p-6 rounded-lg shadow-sm">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Personal Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">First Name*</label>
            <input 
              type="text" 
              [(ngModel)]="formData.personalInfo.firstName"
              (ngModelChange)="markAsTouched('personalInfo.firstName')"
              (blur)="markAsTouched('personalInfo.firstName')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('personalInfo.firstName')}">
            <div *ngIf="hasError('personalInfo.firstName')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('personalInfo.firstName') }}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name*</label>
            <input 
              type="text" 
              [(ngModel)]="formData.personalInfo.lastName"
              (ngModelChange)="markAsTouched('personalInfo.lastName')"
              (blur)="markAsTouched('personalInfo.lastName')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('personalInfo.lastName')}">
            <div *ngIf="hasError('personalInfo.lastName')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('personalInfo.lastName') }}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email*</label>
            <input 
              type="email" 
              [(ngModel)]="formData.personalInfo.email"
              (ngModelChange)="markAsTouched('personalInfo.email')"
              (blur)="markAsTouched('personalInfo.email')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('personalInfo.email')}">
            <div *ngIf="hasError('personalInfo.email')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('personalInfo.email') }}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
            <input 
              type="tel" 
              [(ngModel)]="formData.personalInfo.phone"
              (ngModelChange)="markAsTouched('personalInfo.phone')"
              (blur)="markAsTouched('personalInfo.phone')"
              placeholder="10 digits"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('personalInfo.phone')}">
            <div *ngIf="hasError('personalInfo.phone')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('personalInfo.phone') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Address Information -->
      <div class="bg-white p-6 rounded-lg shadow-sm">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Address Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Street</label>
            <input 
              type="text" 
              [(ngModel)]="formData.addressInfo.street"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
            <input 
              type="text" 
              [(ngModel)]="formData.addressInfo.city"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
            <select 
              [(ngModel)]="formData.addressInfo.state"
              (change)="stateChanged()"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
              <option value="">Select a state</option>
              <option value="AP">Andhra Pradesh</option>
              <option value="AR">Arunachal Pradesh</option>
              <option value="AS">Assam</option>
              <option value="BR">Bihar</option>
              <option value="CG">Chhattisgarh</option>
              <option value="GA">Goa</option>
              <option value="GJ">Gujarat</option>
              <option value="HR">Haryana</option>
              <option value="HP">Himachal Pradesh</option>
              <option value="JK">Jammu and Kashmir</option>
              <option value="JH">Jharkhand</option>
              <option value="KA">Karnataka</option>
              <option value="KL">Kerala</option>
              <option value="MP">Madhya Pradesh</option>
              <option value="MH">Maharashtra</option>
              <option value="MN">Manipur</option>
              <option value="ML">Meghalaya</option>
              <option value="MZ">Mizoram</option>
              <option value="NL">Nagaland</option>
              <option value="OD">Odisha</option>
              <option value="PB">Punjab</option>
              <option value="RJ">Rajasthan</option>
              <option value="SK">Sikkim</option>
              <option value="TN">Tamil Nadu</option>
              <option value="TG">Telangana</option>
              <option value="TR">Tripura</option>
              <option value="UP">Uttar Pradesh</option>
              <option value="UK">Uttarakhand</option>
              <option value="WB">West Bengal</option>
              <option value="DL">Delhi</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">PIN Code</label>
            <input 
              type="text" 
              [(ngModel)]="formData.addressInfo.zipCode"
              (ngModelChange)="markAsTouched('addressInfo.zipCode')"
              (blur)="markAsTouched('addressInfo.zipCode')"
              placeholder="6-digit PIN code"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('addressInfo.zipCode')}">
            <div *ngIf="hasError('addressInfo.zipCode')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('addressInfo.zipCode') }}
            </div>
          </div>
        </div>
        
        <!-- Dynamic section that appears only for certain states -->
        <div *ngIf="showStateSpecificInfo" class="mt-4 p-4 bg-blue-50 rounded-md border border-blue-200">
          <h4 class="font-medium text-blue-800 mb-2">Moving to {{ getStateName(formData.addressInfo.state) }}</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Moving Date</label>
              <input 
                type="date" 
                [(ngModel)]="formData.addressInfo.movingDate"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Previous State</label>
              <select 
                [(ngModel)]="formData.addressInfo.previousState"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                <option value="">Select a state</option>
                <option value="AP">Andhra Pradesh</option>
                <option value="AR">Arunachal Pradesh</option>
                <option value="AS">Assam</option>
                <option value="BR">Bihar</option>
                <option value="CG">Chhattisgarh</option>
                <option value="GA">Goa</option>
                <option value="GJ">Gujarat</option>
                <option value="HR">Haryana</option>
                <option value="HP">Himachal Pradesh</option>
                <option value="JK">Jammu and Kashmir</option>
                <option value="JH">Jharkhand</option>
                <option value="KA">Karnataka</option>
                <option value="KL">Kerala</option>
                <option value="MP">Madhya Pradesh</option>
                <option value="MH">Maharashtra</option>
                <option value="MN">Manipur</option>
                <option value="ML">Meghalaya</option>
                <option value="MZ">Mizoram</option>
                <option value="NL">Nagaland</option>
                <option value="OD">Odisha</option>
                <option value="PB">Punjab</option>
                <option value="RJ">Rajasthan</option>
                <option value="SK">Sikkim</option>
                <option value="TN">Tamil Nadu</option>
                <option value="TG">Telangana</option>
                <option value="TR">Tripura</option>
                <option value="UP">Uttar Pradesh</option>
                <option value="UK">Uttarakhand</option>
                <option value="WB">West Bengal</option>
                <option value="DL">Delhi</option>
              </select>
            </div>
          </div>
          <div class="mt-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Moving</label>
            <textarea 
              [(ngModel)]="formData.addressInfo.movingReason"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              rows="3">
            </textarea>
          </div>
        </div>
      </div>

      <!-- Account Information -->
      <div class="bg-white p-6 rounded-lg shadow-sm">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Account Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Username*</label>
            <input 
              type="text" 
              [(ngModel)]="formData.accountInfo.username"
              (ngModelChange)="markAsTouched('accountInfo.username')"
              (blur)="markAsTouched('accountInfo.username')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('accountInfo.username')}">
            <div *ngIf="hasError('accountInfo.username')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('accountInfo.username') }}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password*</label>
            <input 
              type="password" 
              [(ngModel)]="formData.accountInfo.password"
              (ngModelChange)="markAsTouched('accountInfo.password')"
              (blur)="markAsTouched('accountInfo.password')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('accountInfo.password')}">
            <div *ngIf="hasError('accountInfo.password')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('accountInfo.password') }}
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password*</label>
            <input 
              type="password" 
              [(ngModel)]="formData.accountInfo.confirmPassword"
              (ngModelChange)="markAsTouched('accountInfo.confirmPassword')"
              (blur)="markAsTouched('accountInfo.confirmPassword')"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"
              [ngClass]="{'border-red-500': hasError('accountInfo.confirmPassword')}">
            <div *ngIf="hasError('accountInfo.confirmPassword')" class="text-red-500 text-sm mt-1">
              {{ getErrorMessage('accountInfo.confirmPassword') }}
            </div>
          </div>
          <div class="flex items-center mt-4">
            <input 
              type="checkbox" 
              [(ngModel)]="formData.accountInfo.agreeToTerms"
              (change)="markAsTouched('accountInfo.agreeToTerms')"
              class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
            <label class="ml-2 block text-sm text-gray-700">I agree to the Terms and Conditions*</label>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-8 flex justify-between">
      <button 
        type="button" 
        class="form-button bg-gray-500 hover:bg-gray-600"
        (click)="resetForm()">
        Reset
      </button>
      <button 
        type="button" 
        class="form-button" 
        [disabled]="isFormInvalid()"
        [class.opacity-50]="isFormInvalid()"
        [class.cursor-not-allowed]="isFormInvalid()"
        (click)="submitForm()">
        Submit
      </button>
    </div>

    <div *ngIf="formSubmitted" class="mt-4 p-4 bg-green-100 text-green-800 rounded">
      Form submitted successfully!
    </div>

    <div *ngIf="showDebug" class="mt-8 p-4 bg-gray-100 rounded">
      <h3 class="font-bold">Current Form Data:</h3>
      <pre class="text-xs overflow-auto">{{ formData | json }}</pre>
      <div class="mt-4">
        <h3 class="font-bold">Schema:</h3>
        <pre class="text-xs overflow-auto">{{ formConfig.schema | json }}</pre>
      </div>
      <div class="mt-4">
        <h3 class="font-bold">UI Schema:</h3>
        <pre class="text-xs overflow-auto">{{ formConfig.uiSchema | json }}</pre>
      </div>
    </div>
  </div>
</div>